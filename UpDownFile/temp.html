<html lang="zh"><head><title>list dir</title></head><body>
<div style="position:fixed;bottom:20px;right:10px"><p>
    <label><input type="radio" name="sort" onclick="sortDir(0)"{{if eq .sort 0}}checked{{end}}>名称升序</label>
    <label><input type="radio" name="sort" onclick="sortDir(1)"{{if eq .sort 1}}checked{{end}}>名称降序</label>
</p><p>
    <label><input type="radio" name="sort" onclick="sortDir(2)"{{if eq .sort 2}}checked{{end}}>时间升序</label>
    <label><input type="radio" name="sort" onclick="sortDir(3)"{{if eq .sort 3}}checked{{end}}>时间降序</label>
</p><p>
    <label><input type="radio" name="sort" onclick="sortDir(4)"{{if eq .sort 4}}checked{{end}}>大小升序</label>
    <label><input type="radio" name="sort" onclick="sortDir(5)"{{if eq .sort 5}}checked{{end}}>大小降序</label>
</p><p>
    <label><input type="radio" name="sort" onclick="sortDir(6)"{{if eq .sort 6}}checked{{end}}>后缀升序</label>
    <label><input type="radio" name="sort" onclick="sortDir(7)"{{if eq .sort 7}}checked{{end}}>后缀降序</label>
</p>
    <p><input type="file" id="file"></p>
    <progress value="0" id="progress"></progress>
    <p><input type="button" onclick="uploadFile()" value="上传文件"></p>
    <input type="button" onclick="backSuper()" value="返回上级"/>
    <a href="#top" style="margin:5px">顶部</a>
    <a href="#bottom">底部</a>
</div>

<table border="1" align="center">
    <tr><th>序号</th><th>类型</th><th>大小</th><th>修改时间</th><th>链接</th></tr>
    {{- range $i,$v := .info}}
    <tr><td>{{$v.Index}}</td><td>{{$v.Type}}</td><td>{{$v.Size}}</td><td>{{$v.Time}}</td><td><a href="{{$v.Href}}">{{$v.Name}}</a></td></tr>
    {{- end}}
</table>

<a name="bottom"></a>
<script>
    function uploadFile() {
        let upload = document.getElementById('file').files[0]
        if (!upload) {
            alert('请选择上传文件')
            return
        }
        let params = new FormData()
        params.append('file', upload)
        let xhr = new XMLHttpRequest()
        xhr.onerror = function() {
            alert('请求失败')
        }
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    if (xhr.responseText === "ok") {
                        window.location.reload()
                    } else {
                        alert(xhr.responseText)
                    }
                } else {
                    alert(xhr.status)
                }
            }
        }
        let progress = document.getElementById('progress')
        xhr.upload.onprogress = function(e) {
            progress.value = e.loaded
            progress.max = e.total
        }
        xhr.open('POST', window.location.pathname, true)
        xhr.send(params)
    }
    function sortDir(type) {
        window.location.href = window.location.origin + window.location.pathname + '?sort=' + type
    }
    function backSuper() {
        let url = window.location.pathname
        let i = url.length - 1
        for (;i >= 0 && url[i] === '/';i--){}
        for (;i >= 0 && url[i] !== '/';i--){}
        window.location.href = window.location.origin + url.substring(0,i+1)
    }</script></body></html>